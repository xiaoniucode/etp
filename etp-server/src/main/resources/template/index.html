<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>etp - 内网穿透</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/static/layui/css/layui.css" rel="stylesheet">
    <link rel="icon" href="/static/image/favicon.ico">
    <style>
        .layui-body {
            overflow: hidden;
            margin: 15px;
        }
        #mainFrame {
            width: 100%;
            height: 100%;
            border: none;
        }
        html {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body class="layui-layout-body">

<div class="layui-layout layui-layout-admin">
    <!-- 顶部 -->
    <div class="layui-header">
        <div class="layui-logo layui-bg-black">
            <img src="/static/image/logo.png" alt="ETP" style="width: 80px; height: 40px; border-radius: 4px;"
                 onerror="this.style.display='none'">
        </div>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-sm-inline-block">
                <a href="javascript:;">
                    <img src="/static/image/logo_white.png" class="layui-nav-img">
                    <span id="username">加载中...</span>
                </a>
                <dl class="layui-nav-child">
                    <dd>
                        <a id="openAccountSetting" href="javascript:;">
                            <i class="layui-icon layui-icon-password"></i> 修改密码
                        </a>
                    </dd>
                    <dd>
                        <a id="logout" href="javascript:;">
                            <i class="layui-icon layui-icon-logout"></i> 退出登录
                        </a>
                    </dd>
                </dl>
            </li>
        </ul>
    </div>

    <!-- 左侧菜单 -->
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree" lay-filter="leftMenu">
                <li class="layui-nav-item layui-this">
                    <a href="javascript:;" data-url="/monitor/index.html"><i class="layui-icon layui-icon-console"></i>
                        监控</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;" data-url="/proxy/index.html"><i class="layui-icon layui-icon-link"></i> 映射</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;" data-url="/client/index.html"><i class="layui-icon layui-icon-app"></i> 客户端</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;" data-url="/stats/index.html"><i class="layui-icon layui-icon-chart"></i> 统计</a>
                </li>
            </ul>
        </div>
    </div>
    <!-- 主体内容（使用 iframe） -->
    <div class="layui-body">
        <iframe id="mainFrame" src="/monitor/index.html" frameborder="0"></iframe>
    </div>
</div>

<script src="/static/layui/layui.js"></script>
<script src="/static/js/ajax.js"></script>
<script>
    layui.use(['element', 'layer', 'jquery', 'Rest'], function () {
        const Rest = layui.Rest;
        const $ = layui.$;
        setLoginInfo()
        // 左侧菜单切换页面
        $('.layui-nav-tree .layui-nav-item a').on('click', function () {
            const url = $(this).data('url');
            if (url && url !== '') {
                $('#mainFrame').attr('src', url);
                // 高亮当前菜单
                $menuItems.parent().removeClass('layui-this');
                $(this).parent().addClass('layui-this');
            }
        });
        $('#openAccountSetting').on('click', function () {
            $('#mainFrame').attr('src', '/account.html');
        });

        $('#logout').on('click', function () {
            localStorage.removeItem("user")
            localStorage.removeItem("auth_token")
            Rest.delete('/api/user/logout').then(data => {
                layer.msg('退出成功', {icon: 1, time: 800}, function () {
                    window.location.href = '/login.html';
                });
            })
        });

        function setLoginInfo() {
            try {
                const userStr = localStorage.getItem("user");
                if (userStr) {
                    const user = JSON.parse(userStr);
                    if (user && user.username) {
                        $("#username").text(user.username);
                    }
                }
            } catch (e) {
                console.warn("解析用户信息失败", e);
            }
        }
    });
</script>
</body>
</html>
