<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>客户端</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/static/layui/css/layui.css" rel="stylesheet">
</head>
<body>
<blockquote class="layui-elem-quote">
    Token唯一标识一个客户端，用于与etp服务端建立连接，请妥善保管，不要泄露！
</blockquote>
<table class="layui-hide" id="client" lay-filter="client"></table>

<script type="text/html" id="headerToolbar">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">新增</button>
        <button class="layui-btn layui-btn-sm" lay-event="flush">刷新</button>
    </div>
</script>
<script type="text/html" id="tableToolbar">
    <div class="layui-clear-space">
        <a class="layui-btn layui-btn-xs" lay-event="kickout">踢掉</a>
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-xs" lay-event="delete">删除</a>
    </div>
</script>
<script src="/static/layui/layui.js"></script>
<script src="/static/ajax.js"></script>
<script>
    layui.use(['table', 'dropdown', 'jquery'], function () {
        var table = layui.table;
        const $ = layui.$;
        table.render({
            elem: '#client',
            url: '/client/list',
            toolbar: '#headerToolbar',
            height: 'full-35',
            cols: [[
                {field: 'name', fixed: 'left', width: 150, title: '客户端名'},
                {field: 'secretKey', title: 'Token'},
                {
                    field: 'status', title: '状态', sort: true, templet: function (d) {
                        if (d.status === 1) {
                            return ' <span class="layui-badge layui-bg-green">在线</span>';
                        } else if (d.status === 0) {
                            return '<span class="layui-badge">离线</span>';
                        }
                    }
                },
                {fixed: 'right', title: '操作', width: 200, templet: '#tableToolbar'}
            ]],
            error: function (res, msg) {
                console.log(res, msg)
            }
        });
        //单元格操作事件
        table.on('tool(client)', function (obj) {
            const data = obj.data;
            if (obj.event === 'kickout') {

            } else if (obj.event === 'edit') {
                layer.open({
                    title: '编辑',
                    type: 2,
                    offset: '30px',
                    shade: false,
                    area: ['40%', '30%'],
                    content: '/client/edit.html?id=' + data.id,
                    end: function () {
                        layui.table.reload('client');
                    }
                });
            } else if (obj.event === 'delete') {
                $.ajax({
                    url: '/client/del',
                    type: 'delete',
                    contentType: 'application/json',
                    data: JSON.stringify({id: data.id}),
                    headers: {},
                    success: function (res) {
                        if (res.code === 0) {
                            table.reload('client')
                            layer.msg("删除成功", {time: 2000});
                        } else {
                            layer.msg(res.message, {time: 2000});
                        }
                    },
                });
            } else if (obj.event === 'kickout') {
                $.ajax({
                    url: '/client/kickout',
                    type: 'delete',
                    contentType: 'application/json',
                    data: JSON.stringify({id: data.id}),
                    headers: {},
                    success: function (res) {
                        if (res.code === 0) {
                            table.reload('client')
                            layer.msg("已跌掉", {time: 2000});
                        } else {
                            layer.msg(res.message, {time: 2000});
                        }
                    },
                });
            }
        })
        //操作工具栏
        table.on('toolbar(client)', function (obj) {
            if (obj.event === 'add') {
                layer.open({
                    title: '新增客户端',
                    type: 2,
                    offset: '30px',
                    shade: false,
                    area: ['40%', '30%'],
                    content: '/client/add.html',
                    end: function () {
                        layui.table.reload('client');
                    }
                });
            } else if (obj.event === 'flush') {
                table.reload('client')
            }
        })
    })
</script>
</body>
</html>
