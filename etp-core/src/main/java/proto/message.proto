syntax = "proto3";

package com.xiaoniucode.etp.core.message;

enum MessageType {
  UNKNOWN = 0;
  LOGIN = 101;
  LOGIN_RESP = 104;
  NEW_PROXY = 102;
  CLOSE_PROXY = 103;
  PING = 105;
  NEW_PROXY_RESP = 202;
  ERROR = 205;
  PONG = 206;
  KICKOUT = 301;
  NEW_VISITOR = 302;
  NEW_VISITOR_RESP = 303;
  HEARTBEAT_TIMEOUT = 304;
}

enum ProtocolType {
  TCP = 0;
  HTTP = 1;
}
enum ClientType{
  BINARY_DEVICE = 0;
  WEB_SESSION = 1;
}
enum AccessMode {
  ALLOW = 0;
  DENY = 1;
}

message MessageHeader {
  MessageType type = 1;
}

message Login {
  string clientId = 1;
  string token = 2;
  string name = 3;
  ClientType clientType = 4;
  optional string version = 5;
  optional string os = 6;
  optional string arch = 7;
}
message LoginResp {
  string sessionId = 1;
}
message AccessControl {
  bool enable = 1;
  AccessMode mode = 2;
  repeated string allow = 3;
  repeated string deny = 4;
}
message HttpUser{
  string user = 1;
  string pass = 2;
}
message BasicAuth {
  bool enable = 1;
  repeated HttpUser httpUsers = 2;
}
message NewProxy {
  string name = 1;
  optional string localIp = 2;
  int32 localPort = 3;
  optional int32 status = 4;
  optional bool encrypt = 5;
  optional bool compress = 6;
  ProtocolType protocol = 7;
  optional int32 remotePort = 8;
  optional  bool autoDomain = 9;
  repeated string customDomains = 10;
  repeated string subDomains = 11;
  optional AccessControl accessControl = 12;
  optional BasicAuth basicAuth = 13;
}

message NewProxyResp {
  string proxyName = 1;
  string remoteAddr = 2;
}

message CloseProxy {
  string sessionId = 1;
}

message NewVisitorConn {
  string sessionId = 1;
  string localIp = 2;
  int32 localPort = 3;
  optional bool encrypt = 4;
  optional bool compress = 5;
}

message NewVisitorConnResp {
  string sessionId = 2;
}

message Error {
  int32 code = 1;
  string message = 2;
}
message HeartbeatTimeout{}
message Ping {}
message Pong {}

message Kickout {}

message ControlMessage {
  MessageHeader header = 1;
  oneof payload {
    Login login = 10;
    NewProxy newProxy = 11;
    CloseProxy closeProxy = 12;
    Ping ping = 13;
    NewProxyResp newProxyResp = 20;
    Error error = 21;
    Pong pong = 22;
    Kickout kickout = 30;
    NewVisitorConn newVisitorConn = 31;
    NewVisitorConnResp newVisitorConnResp = 32;
    LoginResp loginResp = 33;
    HeartbeatTimeout heartbeatTimeout = 34;
  }
}